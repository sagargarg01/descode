let chatArea=$(".message_box_container");var userEmail,currentChatRoom,userId,otherUser,chatList=[],socket=io.connect("http://localhost:5000"),checkAndAssignRoom=()=>{chatList.includes(currentChatRoom)||(joinRoom(),chatList.push(currentChatRoom)),messageSending()},joinRoom=()=>{socket.emit("join_room",{user_email:userEmail,chatroom:currentChatRoom})},messageSending=()=>{function s(){let s=$("#chat-message-input"),e=s.val();""!=e&&socket.emit("send_message",{message:e,user_id:userId,user_email:userEmail,chatroom:currentChatRoom}),s.val(""),s.focus()}$("#send-message").click(s),$("input").keydown((function(e){13===e.which&&0==e.shiftKey&&(s(),e.preventDefault())}))};function constructChatROOM(s,e,i){return`\n        <div class="chat_header">\n            <div class="back_button"><i class="fas fa-chevron-left"></i></div>\n            ${i.avatar?`<div><img class="rounded-circle" width="45" src="${i.avatar}" alt=""></div>`:'<div><img class="rounded-circle" width="45" src="//ptetutorials.com/images/user-profile.png" alt=""></div>'}\n\n            <div class="name">${i.name}</div>\n        </div>\n        <div class="mesgs">\n            <div class="msg_history" id="chat-messages-list-${s._id}">\n            ${s.messages.map(s=>(e._id===s.user?`<div class="outgoing_msg">\n                        <div class="sent_msg">\n                            <p>${s.message}</p>\n                        </div>\n                    </div>`:`<div class="incoming_msg">\n                        ${i.avatar?`<div class="incoming_msg_img"> <img class="rounded-circle" src="${i.avatar}" width="40" alt="user"></div>`:'<div class="incoming_msg_img"> <img src="//ptetutorials.com/images/user-profile.png" width="40" alt="user"></div>'}\n                            <div class="received_msg">\n                                <div class="received_withd_msg">\n                                    <p>\n                                    ${s.message}\n                                    </p>\n                                </div>\n                            </div>\n                        </div>`)+" ").join("")}\n            </div>\n            <div class="type_msg">\n                <div class="input_msg_write">\n                    <input type="text" id="chat-message-input" class="write_msg" placeholder="Type a message" />\n                    <button class="msg_send_btn" id="send-message" type="submit"><i class="fa fa-paper-plane-o"aria-hidden="true"></i></button>\n                </div>\n            </div>\n        </div>`}function highLightBox(s){$(".inbox_chat > div").removeClass("active_chat"),$("#friend-"+s).addClass("active_chat")}function hideList(){window.innerWidth<=420&&$(".inbox_people").css("display","none")}function activateBackButton(){$(".back_button").click((function(){$(".inbox_people").css("display","block")}))}function scrollToBottom(){let s=document.getElementsByClassName("msg_history")[0];s.scrollTop=s.scrollHeight}socket.on("receive_message",(function(s){let e=$("#chat-messages-list-"+currentChatRoom),i="other-message",{user_email:t,message:a}=s;t==userEmail&&(i="self-message"),"self-message"===i?e.append(`\n                    <div class="outgoing_msg">\n                        <div class="sent_msg">\n                            <p>${a}</p>\n                        </div>\n                    </div>`):e.append(`\n                    <div class="incoming_msg">\n                    ${otherUser.avatar?`<div class="rounded-circle"> <img src="${otherUser.avatar}" width="40" alt="user"></div>`:'<div class="incoming_msg_img"> <img src="//ptetutorials.com/images/user-profile.png" width="40" alt="user"></div>'}\n                        <div class="received_msg">\n                            <div class="received_withd_msg">\n                                <p>${a}</p>\n                            </div>\n                        </div>\n                    </div>`),scrollToBottom()})),$(".chat_list").each((function(){$(this).click((function(){let s=$(this).attr("data-friendid");highLightBox(s),$.ajax({type:"get",url:"/messages/chatroom/?friend="+s,success:function(s){let{chatRoom:e,user:i,friend:t}=s.data,a=constructChatROOM(e,i,t);chatArea.empty(),chatArea.append(a),scrollToBottom(),hideList(),activateBackButton(),currentChatRoom=e._id,userEmail=i.email,userId=i._id,otherUser=t,checkAndAssignRoom()},error:function(s){console.log(s.responseText)}})}))}));